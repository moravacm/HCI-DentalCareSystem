<Page x:Class="DentalCareSystem.Forms.Pages.MaterialsPageAdmin"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
      xmlns:local="clr-namespace:DentalCareSystem.Util"
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
      mc:Ignorable="d"
      Title="MaterialsPageAdmin">

    <Page.Resources>
        <local:LowStockConverter x:Key="lowStockConverter" />
    </Page.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <materialDesign:Card Grid.Row="0" Margin="0,0,0,10">
            <Label Margin="10"
                   local:LocalizationProvider.ContentID="Materials"
                   FontSize="24"
                   FontWeight="Bold"
                   VerticalAlignment="Center"
                   Style="{StaticResource MaterialDesignLabel}"/>
        </materialDesign:Card>

        <materialDesign:Card Grid.Row="1" Margin="0,0,0,10">
            <Grid Margin="10">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0" HorizontalAlignment="Left" Orientation="Horizontal">
                    <materialDesign:PopupBox
                        Margin="10,5,10,5"
                        PlacementMode="TopAndAlignCentres"
                        StaysOpen="True">
                        <materialDesign:PopupBox.ToggleContent>
                            <StackPanel Orientation="Horizontal">
                                <materialDesign:PackIcon
                                    Width="34"
                                    Height="34"
                                    Kind="SortVariant"
                                    VerticalAlignment="Center" 
                                    local:LocalizationProvider.ToolTipID="Sort"/>
  
                            </StackPanel>
                        </materialDesign:PopupBox.ToggleContent>
                        <Grid Width="250" Margin="8,8,8,8">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                            </Grid.RowDefinitions>

                            <TextBlock
                                Grid.Row="0"
                                Margin="8,8,8,16"
                                local:LocalizationProvider.ContentID="SortBy"
                                Style="{StaticResource MaterialDesignHeadline6TextBlock}" />

                            <ComboBox
                                x:Name="SortComboBox"
                                Grid.Row="1"
                                Margin="8,5,8,10"
                                local:LocalizationProvider.ContentID="SelectSortOption"
                                Style="{StaticResource MaterialDesignFilledComboBox}"
                                SelectedIndex="0">
                                <ComboBoxItem local:LocalizationProvider.ContentID="PriceAscending" Tag="0"/>
                                <ComboBoxItem local:LocalizationProvider.ContentID="PriceDescending" Tag="1"/>
                                <ComboBoxItem local:LocalizationProvider.ContentID="CurrentStockAscending" Tag="2"/>
                                <ComboBoxItem local:LocalizationProvider.ContentID="CurrentStockDescending" Tag="3"/>
                            </ComboBox>

                            <StackPanel
                                Grid.Row="3"
                                Margin="0,10,0,0"
                                HorizontalAlignment="Left"
                                Orientation="Horizontal">
                                <Button
                                    local:LocalizationProvider.ContentID="Apply"
                                    Click="ApplySortButton_Click"
                                    Command="{x:Static materialDesign:PopupBox.ClosePopupCommand}"
                                    Style="{StaticResource MaterialDesignRaisedDarkButton}" />
                                <Button
                                    local:LocalizationProvider.ContentID="Cancel"
                                    Command="{x:Static materialDesign:PopupBox.ClosePopupCommand}"
                                    Style="{StaticResource MaterialDesignFlatDarkButton}"
                                    Margin="10,0,0,0" />    
                                <Button
                                    local:LocalizationProvider.ContentID="ClearSort"
                                    Click="ClearSortButton_Click"
                                    Command="{x:Static materialDesign:PopupBox.ClosePopupCommand}"
                                    Style="{StaticResource MaterialDesignFlatDarkButton}"
                                    Margin="10,0,0,0" />
                            </StackPanel>
                        </Grid>
                    </materialDesign:PopupBox>
                </StackPanel>

                <StackPanel Grid.Column="2" HorizontalAlignment="Right" Orientation="Horizontal">
                    <materialDesign:PopupBox
                        Margin="10,5,10,5"
                        PlacementMode="TopAndAlignCentres"
                        StaysOpen="True">
                        <materialDesign:PopupBox.ToggleContent>
                            <materialDesign:PackIcon
                                Width="30"
                                Height="30"
                                Kind="FilterOutline"
                                local:LocalizationProvider.ToolTipID="Filter"/>
                        </materialDesign:PopupBox.ToggleContent>
                        <Grid Width="300" Margin="8,8,8,8">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                            </Grid.RowDefinitions>
                            <TextBlock
                                Grid.Row="0"
                                Grid.Column="0"
                                Margin="8,8,8,16"
                                local:LocalizationProvider.ContentID="Filter"
                                Style="{StaticResource MaterialDesignHeadline6TextBlock}" />
                            <ComboBox
                                x:Name="ComboBox"
                                Grid.Row="1"
                                Grid.Column="0"
                                Width="140"
                                local:LocalizationProvider.ContentID="StockFilter"
                                Style="{StaticResource MaterialDesignFilledComboBox}">
                                <ComboBoxItem local:LocalizationProvider.ContentID="BelowMin" Tag="BelowMin"/>
                                <ComboBoxItem local:LocalizationProvider.ContentID="Sufficient" Tag="Sufficient"/>
                            </ComboBox>

                            <StackPanel
                                Grid.Row="2"
                                Grid.ColumnSpan="2"
                                Margin="0,10,0,0"
                                HorizontalAlignment="Left"
                                Orientation="Horizontal">
                                <Button
                                    local:LocalizationProvider.ContentID="Apply"
                                    Click="ApplyButton_Click"
                                    Command="{x:Static materialDesign:PopupBox.ClosePopupCommand}"
                                    Style="{StaticResource MaterialDesignRaisedDarkButton}" />
                                <Button
                                    local:LocalizationProvider.ContentID="Cancel"
                                    Command="{x:Static materialDesign:PopupBox.ClosePopupCommand}"
                                    Style="{StaticResource MaterialDesignFlatDarkButton}"
                                    Margin="10,0,0,0" />
                            </StackPanel>
                        </Grid>
                    </materialDesign:PopupBox>

                    <Button
                        Width="30"
                        Height="30"
                        Margin="10,0,30,0"
                        Padding="0"
                        local:LocalizationProvider.ToolTipID="RemoveAllFilters"
                        Click="ClearFilterButton_Click"
                        Style="{StaticResource MaterialDesignToolForegroundButton}">
                        <materialDesign:PackIcon
                            Width="30"
                            Height="30"
                            Kind="FilterRemoveOutline" />
                    </Button>

                    <Button 
                        Margin="0,5,10,5"
                        VerticalAlignment="Center"
                        Click="RefreshButton_Click"
                        local:LocalizationProvider.ToolTipID="Refresh"
                        Content="{materialDesign:PackIcon Refresh}"
                        Style="{StaticResource MaterialDesignFloatingActionMiniLightButton}"
                        ToolTip="Refresh all data"/>
                </StackPanel>
            </Grid>
        </materialDesign:Card>

        <materialDesign:Card Grid.Row="2" Padding="0">
            <TabControl 
                x:Name="MainTabControl"
                TabStripPlacement="Left"
                Style="{StaticResource MaterialDesignTabControl}"
                materialDesign:ColorZoneAssist.Mode="PrimaryLight"
                materialDesign:NavigationRailAssist.SelectionCornerRadius="20"
                materialDesign:NavigationRailAssist.ShowSelectionBackground="True">

                <TabItem>
                    <TabItem.Header>
                        <StackPanel Orientation="Horizontal">
                            <materialDesign:PackIcon Kind="FolderOutline"
                                                     Width="24" Height="24"
                                                     Margin="0,0,10,0"/>
                            <TextBlock local:LocalizationProvider.ContentID="Categories"/>
                        </StackPanel>
                    </TabItem.Header>
                    <TabItem.Content>
                        <DataGrid x:Name="DataGridCategories"
                                  ItemsSource="{Binding Items}"
                                  SelectedItem="{Binding Path=SelectedItem, Mode=TwoWay}"
                                  SelectionChanged="DataGridCategories_SelectionChanged"
                                  AutoGenerateColumns="False"
                                  IsReadOnly="True"
                                  CanUserAddRows="False"
                                  CanUserDeleteRows="False"
                                  ScrollViewer.HorizontalScrollBarVisibility="Visible"
                                  Style="{StaticResource MaterialDesignDataGrid}"
                                  Margin="20,10"
                                  FontSize="15"
                                  FontFamily="{DynamicResource MaterialDesignFont}">

                            <DataGrid.ContextMenu>
                                <ContextMenu>
                                    <MenuItem local:LocalizationProvider.ContentID="Delete"
                                              Click="DeleteCategory_Click"
                                              Icon="{materialDesign:PackIcon Kind=DeleteOutline}"/>
                                    <MenuItem local:LocalizationProvider.ContentID="Add"
                                              Click="AddCategory_Click"
                                              Icon="{materialDesign:PackIcon Kind=PlusCircleOutline}"/>
                                    <MenuItem local:LocalizationProvider.ContentID="Update"
                                              Click="EditCategory_Click"
                                              Icon="{materialDesign:PackIcon Kind=PencilOutline}"/>
                                </ContextMenu>
                            </DataGrid.ContextMenu>

                            <DataGrid.Columns>
                                <DataGridTextColumn local:LocalizationProvider.ContentID="Name"
                                                    Binding="{Binding Name}" Width="*"/>
                            </DataGrid.Columns>
                        </DataGrid>
                    </TabItem.Content>
                </TabItem>

                <TabItem>
                    <TabItem.Header>
                        <StackPanel Orientation="Horizontal">
                            <materialDesign:PackIcon Kind="MedicalBag"
                                                     Width="24" Height="24"
                                                     Margin="0,0,10,0"/>
                            <TextBlock local:LocalizationProvider.ContentID="Materials"/>
                        </StackPanel>
                    </TabItem.Header>
                    <TabItem.Content>
                        <DataGrid x:Name="DataGridMaterials"
                                  ItemsSource="{Binding Items}"
                                  SelectedItem="{Binding Path=SelectedItem, Mode=TwoWay}"
                                  AutoGenerateColumns="False"
                                  IsReadOnly="True"
                                  CanUserAddRows="False"
                                  CanUserDeleteRows="False"
                                  ScrollViewer.HorizontalScrollBarVisibility="Visible"
                                  Style="{StaticResource MaterialDesignDataGrid}"
                                  Margin="20,10"
                                  FontSize="15"
                                  FontFamily="{DynamicResource MaterialDesignFont}">

                            
                            <DataGrid.RowStyle>
                                <Style TargetType="DataGridRow" BasedOn="{StaticResource MaterialDesignDataGridRow}">
                                    <Setter Property="Background" Value="{DynamicResource PrimaryHueLightBrush}" />
                                    <Style.Triggers>
                                        <DataTrigger Value="True">
                                            <DataTrigger.Binding>
                                                <MultiBinding Converter="{StaticResource lowStockConverter}">
                                                    <Binding Path="CurrentStock" />
                                                    <Binding Path="MinimumStock" />
                                                </MultiBinding>
                                            </DataTrigger.Binding>
                                            <Setter Property="Foreground" Value="Red" />
                                            <Setter Property="ToolTip" Value="Upozorenje: Niske zalihe" />
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </DataGrid.RowStyle>

                            <DataGrid.ContextMenu>
                                <ContextMenu>
                                    <MenuItem local:LocalizationProvider.ContentID="Delete"
                                              Click="DeleteMaterial_Click"
                                              Icon="{materialDesign:PackIcon Kind=DeleteOutline}"/>
                                    <MenuItem local:LocalizationProvider.ContentID="Add"
                                              Click="AddMaterial_Click"
                                              Icon="{materialDesign:PackIcon Kind=PlusCircleOutline}"/>
                                    <MenuItem local:LocalizationProvider.ContentID="Update"
                                              Click="EditMaterial_Click"
                                              Icon="{materialDesign:PackIcon Kind=PencilOutline}"/>
                                </ContextMenu>
                            </DataGrid.ContextMenu>

                            <DataGrid.Columns>
                                <DataGridTextColumn local:LocalizationProvider.ContentID="MaterialName"
                                                    Binding="{Binding Name}" Width="*"/>
                                <DataGridTextColumn local:LocalizationProvider.ContentID="MaterialCategory"
                                                    Binding="{Binding Category.Name}" Width="*"/>
                                <DataGridTextColumn local:LocalizationProvider.ContentID="MaterialUnit"
                                                    Binding="{Binding Unit}" Width="*"/>
                                <DataGridTextColumn local:LocalizationProvider.ContentID="MaterialPrice"
                                                    Binding="{Binding PricePerUnit}" Width="*"/>
                                <DataGridTextColumn local:LocalizationProvider.ContentID="MaterialMinStock"
                                                    Binding="{Binding MinimumStock}" Width="*"/>
                                <DataGridTextColumn local:LocalizationProvider.ContentID="MaterialCurrentStock"
                                                    Binding="{Binding CurrentStock}" Width="*"/>
                            </DataGrid.Columns>
                        </DataGrid>
                    </TabItem.Content>
                </TabItem>
            </TabControl>
        </materialDesign:Card>

        <materialDesign:Snackbar x:Name="MaterialsSnackbar"
                                 Grid.Row="2"
                                 Margin="20"
                                 MessageQueue="{materialDesign:MessageQueue}" 
                                 HorizontalAlignment="Right"
                                 VerticalAlignment="Bottom"
                                 Background="{DynamicResource PrimaryHueMidBrush}"
                                 Foreground="White"/>
    </Grid>
</Page>